<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Dplyr verbs for Spatial — dplyr-Spatial â€¢ spdplyr</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>

<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">spdplyr</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/mdsumner/spdplyr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Dplyr verbs for Spatial</h1>
    </div>

    
    <p>Direct application of the dplyr verbs to Spatial objects. There is no need for a conversion from and to Spatial with this approach. Not all verbs are supported, see Details.</p>
    

    <pre class="usage"><span class='co'># S3 method for Spatial</span>
<span class='fu'>mutate</span>(<span class='no'>.data</span>, <span class='no'>...</span>)

<span class='co'># S3 method for Spatial</span>
<span class='fu'>mutate_</span>(<span class='no'>.data</span>, <span class='no'>...</span>, <span class='no'>.dots</span>)

<span class='co'># S3 method for Spatial</span>
<span class='fu'>summarise_</span>(<span class='no'>.data</span>, <span class='no'>...</span>)

<span class='co'># S3 method for Spatial</span>
<span class='fu'>summarise</span>(<span class='no'>.data</span>, <span class='no'>...</span>)

<span class='co'># S3 method for Spatial</span>
<span class='fu'>group_by_</span>(<span class='no'>.data</span>, <span class='no'>...</span>)

<span class='co'># S3 method for Spatial</span>
<span class='fu'>group_by</span>(<span class='no'>.data</span>, <span class='no'>...</span>)

<span class='co'># S3 method for Spatial</span>
<span class='fu'>filter_</span>(<span class='no'>.data</span>, <span class='no'>...</span>, <span class='no'>.dots</span>)

<span class='co'># S3 method for Spatial</span>
<span class='fu'>arrange_</span>(<span class='no'>.data</span>, <span class='no'>...</span>)

<span class='co'># S3 method for Spatial</span>
<span class='fu'>slice_</span>(<span class='no'>.data</span>, <span class='no'>...</span>)

<span class='co'># S3 method for Spatial</span>
<span class='fu'>select_</span>(<span class='no'>.data</span>, <span class='no'>...</span>)

<span class='co'># S3 method for Spatial</span>
<span class='fu'>rename_</span>(<span class='no'>.data</span>, <span class='no'>...</span>)

<span class='co'># S3 method for Spatial</span>
<span class='fu'>distinct_</span>(<span class='no'>.data</span>, <span class='no'>...</span>, <span class='kw'>.keep_all</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)

<span class='co'># S3 method for Spatial</span>
<span class='fu'>left_join</span>(<span class='no'>x</span>, <span class='no'>y</span>, <span class='kw'>by</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>copy</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='no'>...</span>)

<span class='co'># S3 method for Spatial</span>
<span class='fu'>inner_join</span>(<span class='no'>x</span>, <span class='no'>y</span>, <span class='kw'>by</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>copy</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='no'>...</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>.data</th>
      <td><p>A tbl.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Name-value pairs of expressions. See <code><a href='http://www.rdocumentation.org/packages/dplyr/topics/se-deprecated'>mutate_</a></code></p></td>
    </tr>
    <tr>
      <th>.dots</th>
      <td><p>Used to work around non-standard evaluation.</p></td>
    </tr>
    <tr>
      <th>.keep_all</th>
      <td><p>argument for <code><a href='http://www.rdocumentation.org/packages/dplyr/topics/distinct'>distinct</a></code>, we have to set it to TRUE</p></td>
    </tr>
    <tr>
      <th>x</th>
      <td><p>tbls to join</p></td>
    </tr>
    <tr>
      <th>y</th>
      <td><p>tbl to join</p></td>
    </tr>
    <tr>
      <th>by</th>
      <td><p>a character vector of variables to join by.  If <code>NULL</code>, the
default, <code>*_join()</code> will do a natural join, using all variables with
common names across the two tables. A message lists the variables so
that you can check they're right (to suppress the message, simply
explicitly list the variables that you want to join).</p>
<p>To join by different variables on x and y use a named vector.
For example, <code>by = c("a" = "b")</code> will match <code>x.a</code> to
<code>y.b</code>.</p></td>
    </tr>
    <tr>
      <th>copy</th>
      <td><p>If <code>x</code> and <code>y</code> are not from the same data source,
and <code>copy</code> is <code>TRUE</code>, then <code>y</code> will be copied into the
same src as <code>x</code>.  This allows you to join tables across srcs, but
it is a potentially expensive operation so you must opt into it.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>mutate, transmute, filter, arrange, slice, select, rename, distinct all work with attributes on the "data" slot and leave the geometry unchanged.</p>
<p>summarise collapses to a grouped geometries by listing all subgeometries together, it does not perform any topological union or merge, and it takes no account of the calculations done on attributes. 
This is a brutal collapse of all the data, and is identical to what is seen with spplot(x, "group"). The behaviour of geometric collapse like this
is touch and go anyway, see the examples for a what `rgeos::gUnion` does.</p>
<p>summarise for points and multipoints, ... todo single Multipoint for multiple points</p>
    
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>Beware that attributes stored on Spatial objects *are not* linked to the geometry. Attributes are often used to store the area or perimeter length or centroid values but these may be completely unmatched to the underlying geometries.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'>library</span>(<span class='no'>sp</span>)
<span class='fu'>library</span>(<span class='no'>maptools</span>)
<span class='fu'>data</span>(<span class='no'>wrld_simpl</span>)
<span class='fu'>library</span>(<span class='no'>spdplyr</span>)
<span class='fu'>library</span>(<span class='no'>raster</span>)</div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>Attaching package: ‘raster’</span></div><div class='output co'>#&gt; <span class='message'>The following object is masked from ‘package:dplyr’:</span>
#&gt; <span class='message'></span>
#&gt; <span class='message'>    select</span></div><div class='input'><span class='no'>wrld_simpl</span> <span class='kw'>%&gt;%</span> <span class='fu'>mutate</span>(<span class='kw'>NAME</span> <span class='kw'>=</span> <span class='st'>"allthesame"</span>, <span class='kw'>REGION</span> <span class='kw'>=</span> <span class='fu'>row_number</span>())</div><div class='output co'>#&gt; class       : SpatialPolygonsDataFrame 
#&gt; features    : 246 
#&gt; extent      : -180, 180, -90, 83.57027  (xmin, xmax, ymin, ymax)
#&gt; coord. ref. :  +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0 
#&gt; variables   : 11
#&gt; # A tibble: 246 × 11
#&gt;      FIPS   ISO2   ISO3    UN       NAME   AREA  POP2005 REGION SUBREGION
#&gt;    &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt; &lt;int&gt;      &lt;chr&gt;  &lt;int&gt;    &lt;dbl&gt;  &lt;int&gt;     &lt;int&gt;
#&gt;  1     AC     AG    ATG    28 allthesame     44    83039      1        29
#&gt;  2     AG     DZ    DZA    12 allthesame 238174 32854159      2        15
#&gt;  3     AJ     AZ    AZE    31 allthesame   8260  8352021      3       145
#&gt;  4     AL     AL    ALB     8 allthesame   2740  3153731      4        39
#&gt;  5     AM     AM    ARM    51 allthesame   2820  3017661      5       145
#&gt;  6     AO     AO    AGO    24 allthesame 124670 16095214      6        17
#&gt;  7     AQ     AS    ASM    16 allthesame     20    64051      7        61
#&gt;  8     AR     AR    ARG    32 allthesame 273669 38747148      8         5
#&gt;  9     AS     AU    AUS    36 allthesame 768230 20310208      9        53
#&gt; 10     BA     BH    BHR    48 allthesame     71   724788     10       145
#&gt; # ... with 236 more rows, and 2 more variables: LON &lt;dbl&gt;, LAT &lt;dbl&gt;</div><div class='input'><span class='no'>wrld_simpl</span> <span class='kw'>%&gt;%</span> <span class='fu'>transmute</span>(<span class='kw'>alpha</span> <span class='kw'>=</span> <span class='fu'>paste0</span>(<span class='no'>FIPS</span>, <span class='no'>NAME</span>))</div><div class='output co'>#&gt; class       : SpatialPolygonsDataFrame 
#&gt; features    : 246 
#&gt; extent      : -180, 180, -90, 83.57027  (xmin, xmax, ymin, ymax)
#&gt; coord. ref. :  +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0 
#&gt; variables   : 1
#&gt; # A tibble: 246 × 1
#&gt;                    alpha
#&gt;                    &lt;chr&gt;
#&gt;  1 ACAntigua and Barbuda
#&gt;  2             AGAlgeria
#&gt;  3          AJAzerbaijan
#&gt;  4             ALAlbania
#&gt;  5             AMArmenia
#&gt;  6              AOAngola
#&gt;  7      AQAmerican Samoa
#&gt;  8           ARArgentina
#&gt;  9           ASAustralia
#&gt; 10             BABahrain
#&gt; # ... with 236 more rows</div><div class='input'><span class='no'>wrld_simpl</span> <span class='kw'>%&gt;%</span> <span class='fu'>filter</span>(<span class='no'>NAME</span> <span class='kw'>%in%</span> <span class='fu'>c</span>(<span class='st'>"New Zealand"</span>, <span class='st'>"Australia"</span>, <span class='st'>"Fiji"</span>))</div><div class='output co'>#&gt; class       : SpatialPolygonsDataFrame 
#&gt; features    : 3 
#&gt; extent      : -180, 180, -54.74973, -10.05167  (xmin, xmax, ymin, ymax)
#&gt; coord. ref. :  +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0 
#&gt; variables   : 11
#&gt; # A tibble: 3 × 11
#&gt;     FIPS   ISO2   ISO3    UN        NAME   AREA  POP2005 REGION SUBREGION
#&gt; * &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt; &lt;int&gt;      &lt;fctr&gt;  &lt;int&gt;    &lt;dbl&gt;  &lt;int&gt;     &lt;int&gt;
#&gt; 1     AS     AU    AUS    36   Australia 768230 20310208      9        53
#&gt; 2     FJ     FJ    FJI   242        Fiji   1827   828046      9        54
#&gt; 3     NZ     NZ    NZL   554 New Zealand  26799  4097112      9        53
#&gt; # ... with 2 more variables: LON &lt;dbl&gt;, LAT &lt;dbl&gt;</div><div class='input'><span class='fu'>not_run</span>({
  <span class='no'>wrld_simpl</span> <span class='kw'>%&gt;%</span> <span class='fu'>arrange</span>(<span class='no'>LON</span>)
  <span class='no'>wrld_simpl</span> <span class='kw'>%&gt;%</span> <span class='fu'>slice</span>(<span class='fu'>c</span>(<span class='fl'>9</span>, <span class='fl'>100</span>))
  <span class='no'>wrld_simpl</span> <span class='kw'>%&gt;%</span> <span class='kw'>dplyr</span><span class='kw'>::</span><span class='fu'>select</span>(<span class='no'>UN</span>, <span class='no'>FIPS</span>)
  <span class='no'>wrld_simpl</span> <span class='kw'>%&gt;%</span> <span class='fu'>rename</span>(<span class='kw'>`TM_WORLD_BORDERS_SIMPL0.2NAME`</span> <span class='kw'>=</span> <span class='no'>NAME</span>)
  <span class='no'>wrld_simpl</span> <span class='kw'>%&gt;%</span> <span class='fu'>distinct</span>(<span class='no'>REGION</span>, <span class='kw'>.keep_all</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>) <span class='kw'>%&gt;%</span>
     <span class='fu'>arrange</span>(<span class='no'>REGION</span>)  <span class='co'>## first alphabetically in REGION</span>
  <span class='no'>wrld_simpl</span> <span class='kw'>%&gt;%</span> <span class='fu'>arrange</span>(<span class='no'>REGION</span>, <span class='fu'>desc</span>(<span class='no'>NAME</span>)) <span class='kw'>%&gt;%</span> <span class='fu'>distinct</span>(<span class='no'>REGION</span>, <span class='kw'>.keep_all</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>) <span class='co'>## last</span>
})
<span class='co'>## we don't need to use piping</span>
<span class='fu'>slice</span>(<span class='fu'>filter</span>(<span class='fu'>mutate</span>(<span class='no'>wrld_simpl</span>, <span class='kw'>likepiping</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>), <span class='fu'>abs</span>(<span class='no'>LON</span> - <span class='fl'>5</span>) <span class='kw'>&lt;</span> <span class='fl'>35</span> <span class='kw'>&amp;</span> <span class='no'>LAT</span> <span class='kw'>&gt;</span> <span class='fl'>50</span>), <span class='fl'>4</span>)</div><div class='output co'>#&gt; class       : SpatialPolygonsDataFrame 
#&gt; features    : 1 
#&gt; extent      : 20.58093, 31.58893, 59.80499, 69.92722  (xmin, xmax, ymin, ymax)
#&gt; coord. ref. :  +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0 
#&gt; variables   : 12
#&gt; # A tibble: 1 × 12
#&gt;     FIPS   ISO2   ISO3    UN    NAME  AREA POP2005 REGION SUBREGION    LON
#&gt;   &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt; &lt;int&gt;  &lt;fctr&gt; &lt;int&gt;   &lt;dbl&gt;  &lt;int&gt;     &lt;int&gt;  &lt;dbl&gt;
#&gt; 1     FI     FI    FIN   246 Finland 30459 5246004    150       154 26.272
#&gt; # ... with 2 more variables: LAT &lt;dbl&gt;, likepiping &lt;lgl&gt;</div><div class='input'>

<span class='co'>## works with Lines</span>
<span class='co'>#as(wrld_simpl, "SpatialLinesDataFrame") %&gt;% </span>
 <span class='co'># mutate(perim = rgeos::gLength(wrld_simpl, byid = TRUE))</span>

<span class='fu'>not_run</span>({
  <span class='co'>## summarise/ze can be used after group_by, or without</span>
  <span class='no'>wrld_simpl</span> <span class='kw'>%&gt;%</span> <span class='fu'>filter</span>(<span class='no'>REGION</span> <span class='kw'>==</span> <span class='fl'>150</span>) <span class='kw'>%&gt;%</span> <span class='fu'>summarize</span>(<span class='fu'>max</span>(<span class='no'>AREA</span>))
  <span class='no'>wrld_simpl</span> <span class='kw'>%&gt;%</span> <span class='fu'>group_by</span>(<span class='no'>REGION</span>) <span class='kw'>%&gt;%</span> <span class='fu'>summarize</span>(<span class='fu'>max</span>(<span class='no'>AREA</span>)) <span class='kw'>%&gt;%</span>
  <span class='fu'>plot</span>(<span class='kw'>col</span> <span class='kw'>=</span> <span class='fu'>rainbow</span>(<span class='fu'>nlevels</span>(<span class='fu'>factor</span>(<span class='no'>wrld_simpl</span>$<span class='no'>REGION</span>)), <span class='kw'>alpha</span> <span class='kw'>=</span> <span class='fl'>0.3</span>))
})
<span class='co'>## group_by and summarize</span>

<span class='fu'>not_run</span>({
  <span class='no'>g</span> <span class='kw'>&lt;-</span> <span class='no'>wrld_simpl</span>  <span class='kw'>%&gt;%</span> <span class='fu'>group_by</span>(<span class='no'>REGION</span>)  <span class='kw'>%&gt;%</span>
   <span class='fu'>summarize</span>(<span class='kw'>alon</span> <span class='kw'>=</span> <span class='fu'>mean</span>(<span class='no'>LON</span>), <span class='kw'>mxlat</span> <span class='kw'>=</span> <span class='fu'>max</span>(<span class='no'>LAT</span>), <span class='kw'>mxarea</span> <span class='kw'>=</span> <span class='fu'>max</span>(<span class='no'>AREA</span>))
  <span class='no'>g</span> <span class='kw'>%&gt;%</span> <span class='fu'>mutate</span>(<span class='kw'>ar</span> <span class='kw'>=</span> <span class='fu'>factor</span>(<span class='no'>REGION</span>)) <span class='kw'>%&gt;%</span> <span class='fu'>spplot</span>(<span class='st'>"ar"</span>)
  <span class='no'>w</span> <span class='kw'>&lt;-</span> <span class='no'>wrld_simpl</span>
  <span class='no'>w</span>$<span class='no'>ar</span> <span class='kw'>&lt;-</span> <span class='fu'>factor</span>(<span class='no'>w</span>$<span class='no'>REGION</span>)
  <span class='fu'>spplot</span>(<span class='no'>w</span>, <span class='st'>"ar"</span>)
})
<span class='fu'>not_run</span>({
  <span class='co'># compare what rgeos gives</span>
  <span class='co'>##spplot(rgeos::gUnionCascaded(w, id = w$ar))  ## good grief, is this compelling . . .</span>
  <span class='co'>## this is hardly a clean dissolve</span>
  <span class='co'>##plot(rgeos::gUnionCascaded(w, id = w$ar), col = rainbow(nlevels(factor(w$ar)), alpha = 0.5))</span>
})</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#details">Details</a></li>

      <li><a href="#note">Note</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Michael D. Sumner.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
